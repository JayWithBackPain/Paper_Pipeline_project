# 需求文件

## 簡介

本專案旨在建立一個完整的學術論文資料處理管線，從 arXiv 資料的收集、處理、向量化到可觀測性監控。系統將使用 AWS 雲端服務，包含 Lambda、S3、DynamoDB 等，並結合 Go 和 Python 技術棧來實現高效能的資料處理與機器學習功能。

## 需求

### 需求 1: 大量資料收集與壓縮存儲

**使用者故事：** 身為資料工程師，我希望能建立一個每日執行的大量資料收集系統，從 API 回傳格式獲取資料，並將其壓縮存儲，以便為後續處理流程提供可靠且高效的資料來源。

#### 驗收標準

1. 當系統每日執行資料收集時，系統應能適配回傳格式，透過 YAML 設定檔規劃 pipeline 需要接收和儲存的格式
2. 當系統收集大量資料時，系統應將所有資料壓縮成單一檔案（如 gzip 格式）存儲至 S3
3. 當資料存儲至 S3 時，系統應確保檔案命名包含日期戳記，避免重複存儲相同日期的資料

### 需求 2: 批次資料處理與 Upsert 操作

**使用者故事：** 身為資料科學家，我希望能將 S3 中的壓縮資料進行批次處理、去重和轉換，並透過 upsert 操作確保資料的一致性，以便進行高效能的分析與查詢。

#### 驗收標準

1. 當系統處理 S3 壓縮檔案時，系統應能解壓縮並批次處理大量資料記錄
2. 當系統進行資料清洗時，系統應識別並移除重複記錄，確保資料唯一性
3. 當資料寫入 DynamoDB 時，系統應使用 upsert 操作（PUT with condition 或 UPDATE），確保相同 ID 的資料被更新而非重複插入
4. 當進行批次寫入時，系統應將資料分批處理（每批 25 筆），減少 I/O 操作並提升效能
5. 當批次處理失敗時，系統應記錄失敗的批次並支援重試機制，確保資料完整性

### 需求 3: 機器學習與向量化服務

**使用者故事：** 身為後端工程師，我希望能建立一個 NLP 服務，將論文文字內容轉換為向量，以便實現基於語意的論文推薦功能。

#### 驗收標準

1. 當呼叫向量化 API 時，系統應接受文字輸入並回傳對應的 embedding 向量
2. 當處理論文資料時，系統應將輸入的字段組合轉換成向量並存入 DynamoDB，初步撰寫時以論文的標題及摘要來做向量化計算。
3. 當向量化服務運行時，系統應使用 Python 和 Hugging Face 模型

### 需求 4: 系統可觀測性

**使用者故事：** 身為資料工程師，我希望能確保整個大量資料處理管線的健康、穩定與可追蹤性，透過 cloudwatch 紀錄 pipeline 運作的指標

#### 驗收標準

1. 當 Lambda 服務執行時，系統應輸出結構化日誌到 CloudWatch Logs，包含處理的資料量、執行時間
2. 當處理大量資料時，系統應監控批次處理進度、成功率和失敗重試次數
3. 當資料去重和 upsert 操作執行時，系統應記錄重複資料數量和更新操作統計
4. 保持每個端到端之間獨立服務的原則，將端點之間的流動都獨立成各自的 lambda function 來準備部署
5. logs 輸出的語法不應該影響程式碼閱讀難度，以優雅簡潔為原則
6. 當所有 Go 服務（data-collector、batch-processor 等）運行時，系統應使用統一的結構化 logger 介面，包含相同的方法簽名和日誌格式
7. 當任何 Go 服務記錄日誌時，系統應包含 service name、trace ID、request ID 等 context 資訊，確保跨服務的可追蹤性
8. 當所有 Go 服務中的組件記錄資訊時，系統應使用結構化 JSON 格式而非 log.Printf，以便於日誌解析和分析
9. 當任何 Go 服務遇到錯誤時，系統應記錄結構化錯誤詳情，包含錯誤類型、訊息和相關 context 資訊
10. 當新增 Go 服務時，系統應能複用相同的 logger 套件，確保整個 pipeline 的日誌一致性

### 需求 5: 專案結構與程式碼品質

**使用者故事：** 身為開發工程師，我希望專案具有清晰的結構和優雅的程式碼設計，以便團隊成員能夠快速上手並長期維護系統。

#### 驗收標準

1. 當開發人員查看專案時，系統應具有清晰的目錄結構，按功能模組化組織
2. 當開發人員閱讀程式碼時，函數和介面應遵循單一職責原則，具有清晰的命名和文件
3. 系統應提供簡潔有力的 README 說明模組的作業方式，需要包含高層次流程圖以及模組作業流程圖
4. 當擴展功能時，系統架構應支援新功能的輕鬆添加，不影響現有功能
5. 把 go 和 python 專案分開成不同的 dictionary 放置方便閱讀
6. 為適應能讓 junior 工程師能 pickup , 專案需要高度的優雅不冗長
7. 當開發人員閱讀 batch-processor 代碼時，系統應避免使用不必要的 adapter 模式，直接使用具體類型和介面，確保代碼的直觀性和可讀性
8. 當 processor 與其他組件交互時，系統應使用明確的類型定義而非 interface{} 泛型，提高代碼的類型安全性和可維護性

### 需求 6: 高速開發及部署

**使用者故事：** 身為資料工程師，我希望專案可以透過本機編譯，並且透過 aws cli 部署到 lambda 上，不使用到 docker 以及其他容器

#### 驗收標準
1. 完整的 makefile 提供編譯及部署腳本